---
kind: Template
apiVersion: v1
metadata:
  name: packit-service-tests-template
# parameters:
# - name: PACKIT_SERVICE_SRC_LOCAL_PATH
#   displayName: Packit Service Sources Path
#   description: Local path to packit-service sources
#   required: true
objects:
- apiVersion: batch/v1
  kind: Job
  metadata:
    name: packit-tests
  spec:
    template:
      spec:
        volumes:
        - name: packit-secrets
          secret:
            secretName: packit-secrets
        - name: packit-config
          secret:
            secretName: packit-config
        restartPolicy: Never
        containers:
        - name: packit-tests
          image: packit-service-tests:latest
          imagePullPolicy: Never  # IfNotPresent
          workingDir: /src-packit-service
          volumeMounts:
          - name: packit-secrets
            mountPath: /secrets
          - name: packit-config
            mountPath: /home/packit/.config
          command: ["bash", "/src-packit-service/files/run_tests.sh"]
    backoffLimit: 1
